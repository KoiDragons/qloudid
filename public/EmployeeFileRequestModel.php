<?php
	require_once('../AppModel.php');
	class EmployeeFileRequestModel extends AppModel
	{
		function updateFile()
		{
			$dbCon = AppModel::createConnection();
			$allowedExts = array("csv");
		 
			$temp = explode(".", $_FILES["file1"]["name"]);
			$extension = end($temp);
			//echo $extension; die;
			 
				if ($_FILES["file1"]["error"] > 0) {
					$msg = "Return Code: " . $_FILES["file"]["error"] . "<br>";
					return 2;
					} else {
					
					if (file_exists("uploads/employee_csv/" . $_FILES["file1"]["name"])) 
					unlink("uploads/employee_csv/" . $_FILES["file1"]["name"]);
					$micro=$this->encrypt_decrypt('encrypt',microtime());
					move_uploaded_file($_FILES["file1"]["tmp_name"], "uploads/employee_csv/" .$micro."". $_FILES["file1"]["name"]);
					
					$file = file_get_contents('uploads/employee_csv/'.$micro.''.$_FILES["file1"]["name"], FILE_USE_INCLUDE_PATH);
					$emails = explode("\n" , $file);
					$file_a='/uploads/employee_csv/'.$micro.''.$_FILES["file1"]["name"];
					$file_address='https://qloudid.com/public/'.$file_a;
					$file_a= str_replace('\\', '/', getcwd().$file_a);
					 
					$file_e=encrypt_decrypt('encrypt',$file_a);
					$_SESSION['file_e']=$file_e;
					
					$stmt = $dbCon->prepare("INSERT INTO employee_profile_create_request (first_name,last_name,email,file_path,created_on) VALUES (?, ?, ?, ?, now())");
					$stmt->bind_param("ssss", $data['first_name'], $data['last_name'],$data['email'],$file_address);
					$stmt->execute();
					 
					$to='kowaken.ghirmai@gmail.com';
					$subject='Profile update request - file';
					$emailContent='<html><head></head><body><table width="100%" cellpadding="0" cellspacing="0" style="color:rgb(51,51,51);font-family:Helvetica;font-size:12px;font-style:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;text-decoration:none;border-collapse:collapse;width:806px;margin:0px;padding:0px;background-color:rgb(245,243,235)"><tbody><tr><td align="center" style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif"><table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse;width:806px;margin:0px;padding:0px"><tbody><tr><td width="100%" cellpadding="5" cellspacing="0" style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;padding:10px 0px"><table align="center" width="600" cellpadding="0" cellspacing="0" style="border-collapse:collapse"><tbody><tr><td style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;text-align:center;font-size:12px;color:rgb(169,166,150)"></td></tr></tbody></table></td></tr><tr><td width="100%" cellpadding="0" cellspacing="0" style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif"><table align="center" width="600" cellpadding="0" cellspacing="0" style="border-collapse:collapse;background-color:rgb(255,255,255)"><tbody><tr><td style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;background-color:rgb(255,222,0);text-align:center;padding:30px 0px"><a href="https://click.pstmrk.it/3s/postmarkapp.com/I54/omO0AQ/AQ/fc4996d3-c38b-4eb4-87c4-96e57759d663/1/XpxyQPwh_w" style="color:rgb(0,123,200);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://click.pstmrk.it/3s/postmarkapp.com/I54/omO0AQ/AQ/fc4996d3-c38b-4eb4-87c4-96e57759d663/1/XpxyQPwh_w&amp;source=gmail&amp;ust=1713493741023000&amp;usg=AOvVaw1MYeBmb0BG5q1w3tLZOrYV"><img label="Logo" src="https://ci3.googleusercontent.com/meips/ADKq_NYdFirJRDQzgqhjdT59ek4mTs8iK7-nx1SG2xQIVeqQG-2IK4X5jE7Ncx8U0_71FgTwvZejIXF-YhZC2LAUeclJcPoWIlDrmwMRxJH6T1iU9ZiUkic=s0-d-e1-ft#https://newsletter.postmarkapp.com/assets/images/pm_logo@2x.png" width="200" alt="ActiveCampaign Postmark" style="border:none;vertical-align:middle" class="CToWUd" data-bit="iit"></a></td></tr>

<tr><td style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;padding:50px;background-color:rgb(255,255,255)"><h1 style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;margin:0px 0px 15px;color:rgb(51,51,51);font-weight:bold;font-size:21px;text-align:left">Hi Kowaken<img data-emoji="??" class="an1" alt="??" aria-label="??" draggable="false" src="https://fonts.gstatic.com/s/e/notoemoji/15.0/1f44b/72.png" loading="lazy" style="width:24px;"></h1><div>

<p style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;line-height:24px;text-align:left;margin-top:0px;margin-bottom:25px;color:rgb(51,51,51);font-size:15px">We have received a request from '.$_POST['first_name'].' to create a profile for them. Please click on below button to download the file they have uploaded.
<span> </span>.</p><div style="margin-bottom:25px"><a href="'.$file_address.'" style="color:rgb(255,255,255);text-decoration:none;box-sizing:border-box;border-width:10px 18px;border-style:solid;border-color:rgb(0,123,200);background-color:rgb(0,123,200);font-size:14px;display:inline-block;height:auto;border-radius:3px;text-align:center;font-weight:bold;padding:5px 10px;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="'.$file_address.'">Download file</a></div></div></td></tr></tbody></table><table align="center" width="600" cellpadding="0" cellspacing="0" style="border-collapse:collapse;background-color:rgb(255,222,0);color:rgb(39,39,39)!important"><tbody><tr><td style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;padding:50px 50px 0px;background-color:rgb(255,222,0)"><h1 style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;margin:0px 0px 15px;font-weight:bold;font-size:21px;text-align:left;color:rgb(39,39,39)!important">Other things to know</h1><div><h2 style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;margin-top:1.333em;font-weight:bold;font-size:18px;text-align:left;margin-bottom:0.666em;color:rgb(39,39,39)!important"><img src="https://ci3.googleusercontent.com/meips/ADKq_NYq2PgPv_6KU0rCQGUwQpIuPzMHasrPm3Bm5F5GfeYfn6tWKk9iQh_wlvBHS1xBHhpfssfJaccnV6dPSXLv9XR5RDfr1Vv6-dr_6fUAZiI0t6iGyIwTkZ-QP-8E=s0-d-e1-ft#https://newsletter.postmarkapp.com/assets/images/icon-test-mode@2x.png" alt="" width="18" height="18" style="margin-right:2px" class="CToWUd" data-bit="iit"><span>&nbsp;</span>Test mode and requesting account approval</h2><p style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;line-height:24px;text-align:left;margin-top:0px;margin-bottom:25px;font-size:15px;color:rgb(39,39,39)!important">Your account is currently in test mode. That allows you to get familiar with Postmark, and<span>&nbsp;</span><strong style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif">send up to 100 emails to domains that you’ve verified.</strong>Once you’re ready to send emails to others, we’ll need to approve your account. Why? Reviewing each account helps us tell the<span>&nbsp;</span><a href="https://postmarkapp.com/support/article/1082-what-types-of-messages-are-a-good-fit-for-postmark?utm_source=pm_onboarding&amp;utm_medium=email&amp;utm_campaign=2110_onboarding" style="color:rgb(0,94,153);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://postmarkapp.com/support/article/1082-what-types-of-messages-are-a-good-fit-for-postmark?utm_source%3Dpm_onboarding%26utm_medium%3Demail%26utm_campaign%3D2110_onboarding&amp;source=gmail&amp;ust=1713578252654000&amp;usg=AOvVaw0CG_6cwWiQF_2r5PjsW26Y">responsible senders</a><span>&nbsp;</span>(that’s you!) apart from the spammers (boo!), so we can maintain our stellar deliverability rates for all customers. So whenever you’re ready,<span>&nbsp;</span><a href="https://account.postmarkapp.com/account_approval/apply" style="color:rgb(0,94,153);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://account.postmarkapp.com/account_approval/apply&amp;source=gmail&amp;ust=1713578252654000&amp;usg=AOvVaw06OBKYFhPTw5XMftmhKGaQ">submit an approval request</a>.</p><h2 style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;margin-top:1.333em;font-weight:bold;font-size:18px;text-align:left;margin-bottom:0.666em;color:rgb(39,39,39)!important"><img src="https://ci3.googleusercontent.com/meips/ADKq_Nbrd0cZRFFzQiVERmldeUsggD54HKSjr97Xj5vWhYkUyzFHBGxgeBNZPwCYIO0AjY5rQDCtZE2k-EJTz9BlknDytN6qN9Wglwb8ZwWGHRE6gZK9FKd69Zl7HqbvrAA=s0-d-e1-ft#https://newsletter.postmarkapp.com/assets/images/icon-get-started@2x.png" alt="" width="18" height="18" style="margin-right:2px" class="CToWUd" data-bit="iit"><span>&nbsp;</span>Handy resources to help you get started</h2><p style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;line-height:24px;text-align:left;margin-top:0px;margin-bottom:25px;font-size:15px;color:rgb(39,39,39)!important">Check out our easy-to-follow<span>&nbsp;</span><a href="https://postmarkapp.com/manual?utm_source=pm_onboarding&amp;utm_medium=email&amp;utm_campaign=2110_onboarding" style="color:rgb(0,94,153);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://postmarkapp.com/manual?utm_source%3Dpm_onboarding%26utm_medium%3Demail%26utm_campaign%3D2110_onboarding&amp;source=gmail&amp;ust=1713578252654000&amp;usg=AOvVaw1kqvQ5uN8D6z3MX4OYETPM">getting started guides</a><span>&nbsp;</span>and detailed<span>&nbsp;</span><a href="https://postmarkapp.com/developer?utm_source=pm_onboarding&amp;utm_medium=email&amp;utm_campaign=2110_onboarding" style="color:rgb(0,94,153);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://postmarkapp.com/developer?utm_source%3Dpm_onboarding%26utm_medium%3Demail%26utm_campaign%3D2110_onboarding&amp;source=gmail&amp;ust=1713578252654000&amp;usg=AOvVaw12NlHIMjaaaYAUStModOdx">developer docs</a><span>&nbsp;</span>to get set up in Postmark. Still need help? Our Customer Success team is<span>&nbsp;</span><a href="https://twitter.com/nckrtl/status/1377714048364597250" style="color:rgb(0,94,153);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://twitter.com/nckrtl/status/1377714048364597250&amp;source=gmail&amp;ust=1713578252654000&amp;usg=AOvVaw101emP5hRHmoClsAaDnbxj">pretty</a><span>&nbsp;</span><a href="https://twitter.com/garrettdimon/status/1390489002801782786" style="color:rgb(0,94,153);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://twitter.com/garrettdimon/status/1390489002801782786&amp;source=gmail&amp;ust=1713578252654000&amp;usg=AOvVaw1HhLK592C4wLEzDCw4ylPk">darn</a><span>&nbsp;</span><a href="https://twitter.com/dixpac/status/1390587202191699970" style="color:rgb(0,94,153);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://twitter.com/dixpac/status/1390587202191699970&amp;source=gmail&amp;ust=1713578252654000&amp;usg=AOvVaw0SJwwZy4VmW0zm5GXLiZoq">great</a>, so just reply to this message if you have any questions.</p><div style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;line-height:24px;text-align:left;margin-top:0px;font-size:15px;margin-bottom:0px!important;color:rgb(39,39,39)!important">Happy sending,<br>The Postmark Team</div></div><div style="margin-top:50px;text-align:center"><img src="https://ci3.googleusercontent.com/meips/ADKq_NafQzHg7FrvW-wMBmxDfvRvDPA_kAe3gisUl9M-CyZAlwd6WRweAY4C1AOUWB13sQAoviKHcPuMnEv7yuj66TVWmuf4afj2dHvhcvlIuyUfAB0kvZNQm8IKCain=s0-d-e1-ft#https://newsletter.postmarkapp.com/assets/images/signup-machine@2x.png" alt="" width="461.5" height="243" style="vertical-align:middle" class="CToWUd a6T" data-bit="iit" tabindex="0"><div class="a6S" dir="ltr" style="opacity: 0.01; left: 633.234px; top: 1480.28px;"><span data-is-tooltip-wrapper="true" class="a5q" jsaction="JIbuQc:.CLIENT"><button class="VYBDae-JX-I VYBDae-JX-I-ql-ay5-ays CgzRE" jscontroller="PIVayb" jsaction="click:h5M12e; clickmod:h5M12e;pointerdown:FEiYhc;pointerup:mF5Elf;pointerenter:EX0mI;pointerleave:vpvbp;pointercancel:xyn4sd;contextmenu:xexox;focus:h06R8; blur:zjh6rb;mlnRJb:fLiPzd;" data-idom-class="CgzRE" jsname="hRZeKc" aria-label="Download attachment " data-tooltip-enabled="true" data-tooltip-id="tt-c85" data-tooltip-classes="AZPksf" id="" jslog="91252; u014N:cOuCgd,Kr2w4b,xr6bB; 4:WyIjbXNnLWY6MTc5NjcyNjQwMjk4MjM0NTczNiJd; 43:WyJpbWFnZS9qcGVnIl0."><span class="OiePBf-zPjgPe VYBDae-JX-UHGRz"></span><span class="bHC-Q" data-unbounded="false" jscontroller="LBaJxb" jsname="m9ZlFb" soy-skip="" ssk="6:RWVI5c"></span><span class="VYBDae-JX-ank-Rtc0Jf" jsname="S5tZuc" aria-hidden="true"><span class="bzc-ank" aria-hidden="true"><svg height="20" viewBox="0 -960 960 960" width="20" focusable="false" class=" aoH"><path d="M480-336 288-528l51-51 105 105v-342h72v342l105-105 51 51-192 192ZM263.717-192Q234-192 213-213.15T192-264v-72h72v72h432v-72h72v72q0 29.7-21.162 50.85Q725.676-192 695.96-192H263.717Z"></path></svg></span></span><div class="VYBDae-JX-ano"></div></button><div class="ne2Ple-oshW8e-J9" id="tt-c85" role="tooltip" aria-hidden="true">Download</div></span></div></div></td></tr><tr><td style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;padding:10px 50px;background-color:rgb(53,57,66);color:rgb(255,255,255);border-top-width:0px"><div style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;line-height:24px;text-align:center;margin:0px;color:rgb(53,57,66);font-size:14px"><img data-emoji="??" class="an1" alt="??" aria-label="??" draggable="false" src="https://fonts.gstatic.com/s/e/notoemoji/15.0/1f48c/72.png" loading="lazy"><span>&nbsp;</span><a href="https://postmarkapp.com/newsletter" style="color:rgba(255,255,255,0.5);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://postmarkapp.com/newsletter&amp;source=gmail&amp;ust=1713578252654000&amp;usg=AOvVaw0jUhYtnjc-UpK__nuM8iMz">Subscribe to the Postmark newsletter</a></div></td></tr><tr style="padding:0px 50px;background-color:rgb(245,243,235);color:rgb(255,255,255)"><td style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;padding:25px 0px"><div style="font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif;line-height:24px;text-align:center;margin:0px;color:rgb(169,166,150);font-size:14px"><a href="https://activecampaign.com/" style="color:rgb(169,166,150);text-decoration:underline;font-family:&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://activecampaign.com/&amp;source=gmail&amp;ust=1713578252654000&amp;usg=AOvVaw2s1Vhu798w4qnmBaf8YYYA">ActiveCampaign LLC</a>, 1 North Dearborn St, 5th Floor, Chicago, IL 60602</div></td></tr></tbody></table></td></tr></tbody></table></td></tr></tbody></table></body></html>';

 

try{
				sendEmail($subject, $to, $emailContent);
			}
			catch(Exception $e) {
				$to='kowaken.ghirmai@gmail.com';
				sendEmail($subject, $to, $emailContent);
			}
					$stmt->close();
			$dbCon->close();
			return 1;
				}
				
			 
		}	
		
	}		